import hvac
import psycopg2

# Define Vault configuration
vault_address = 'http://vault.example.com:8200'
vault_token = 'your_vault_token'

# Connect to Vault
client = hvac.Client(url=vault_address, token=vault_token)

# Define the path to your secret in Vault
vault_secret_path = 'secret/data/myapp/db_credentials'

# Retrieve the credentials from Vault
vault_response = client.secrets.kv.v2.read_secret_version(path=vault_secret_path)
db_credentials = vault_response['data']['data']

# Database configuration
db_host = db_credentials['host']
db_port = db_credentials['port']
db_name = db_credentials['database']
db_user = db_credentials['username']
db_password = db_credentials['password']

# Connect to the database
try:
    connection = psycopg2.connect(
        host=db_host,
        port=db_port,
        database=db_name,
        user=db_user,
        password=db_password
    )
    
    # Now you can perform database operations using the 'connection' object
    
    # Example: create a cursor and execute a query
    cursor = connection.cursor()
    cursor.execute("SELECT * FROM your_table")
    result = cursor.fetchall()
    
    # Remember to commit and close the connection when done
    connection.commit()
    connection.close()

except psycopg2.Error as e:
    print("Error connecting to the database:", e)
